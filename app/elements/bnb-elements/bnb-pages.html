<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/paper-badge/paper-badge.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="bnb-page-card.html">
<link rel="import" href="bnb-period-dropdown.html">

<dom-module id="bnb-pages">

  <style>
    :host {
      @apply(--layout-horizontal);
    }

    #noData, #loading {
      display: flex;

      width: 100%;
      height: 100%;

      color: #999;

      font-size: 24px;

      align-items: center;
      justify-content: center;
    }

    #withData {
      padding:24px;
      @apply(--layout-fit);
      @apply(--layout-wrap);
      @apply(--layout-horizontal);
      @apply(--layout-center-justified);
    }

    paper-item {
      cursor: pointer;
    }
  </style>
  <template>
    <paper-header-panel class="flex">
      <paper-toolbar>
        <span>All pages</span>
        <div class="flex"></div>
        <paper-icon-button id="addBtn" icon="add" on-tap="addTapped"></paper-icon-button>
        <paper-menu-button horizontal-align="right">
          <paper-icon-button id="moreBtn" icon="more-vert" class="dropdown-trigger"></paper-icon-button>
          <paper-menu class="dropdown-content" style="z-index:9999">
            <paper-item on-tap="preferencesTapped">User preferences</paper-item>
            <paper-divider></paper-divider>
            <paper-item on-tap="signoutTapped">Log out</paper-item>
          </paper-menu>
        </paper-menu-button>
      </paper-toolbar>
      <div class="content">
        <iron-pages selected="[[computeSelected(pages)]]" class="fit">
          <section id="loading">
            <span>Loading&nbsp;</span>
            <paper-spinner active></paper-spinner>
          </section>
          <section id="noData">Don't you dare try the + button in the toolbar !</section>
          <section id="withData">
            <template is="dom-repeat" items="{{pages}}" as="item" sort="sortPages">
              <bnb-page-card page="[[item]]"></bnb-page-card>
            </template>
          </section>
        </iron-pages>
      </div>
    </paper-header-panel>

  </template>
</dom-module>
<script>
(function() {
  Polymer({
    is: 'bnb-pages',

    properties: {
      pages: {
        type: Array
      },
      period: {
        type: Object
      }
    },

    behaviors: [
      Polymer.NeonAnimatableBehavior,
      Polymer.IronResizableBehavior
    ],

    computeSelected: function(pages) {
      if (pages === null || pages === undefined) {
        return 0;
      }
      if (pages.length === 0) {
        return 1;
      }
      return 2;
    },

    sortPages: function(first, second) {
      var a = first.name.toUpperCase();
      var b = second.name.toUpperCase();
      return a.localeCompare(b);
    },

    selectedChanged: function() {
      this.page = this.pages[this.selected];
    },

    addTapped: function() {
      page('/add-page');
    },

    preferencesTapped: function() {
      this.fire('edit-preferences');
    },

    signoutTapped: function() {
      this.fire('signedout');
    }
  });

})();
</script>
