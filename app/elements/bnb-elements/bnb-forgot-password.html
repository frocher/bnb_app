<link rel="import" href="../../bower_components/iron-a11y-keys/iron-a11y-keys.html">

<dom-module id="bnb-forgot-password">
  <style>
    :host {
      @apply(--layout-vertical);
    }
  </style>

  <template>
    <iron-a11y-keys keys="enter" target="[[target]]" on-keys-pressed="submitTapped"></iron-a11y-keys>

    <bnb-auth-form id="forgot-form" title="Password forgotten" buttons="{{forgotButtons}}">
      <paper-input id="forgot-email" label="E-mail" type="email" value="{{params.email}}" autofocus="true">
      </paper-input>

      <div class="actions">
        <paper-button on-tap="submitTapped">Reset password</paper-button>
      </div>
    </bnb-auth-form>
  </template>
</dom-module>

<script>
(function() {

  Polymer({
    is: 'bnb-forgot-password',

    properties: {
      target: {
        type: Object,
        value: function() {
          return this.$['forgot-form'];
        }
      }
    },

    ready: function() {
      this.params = { email:'', redirect_url: this.editPasswordUrl() };
      this.forgotButtons = [{text:'Sign up', path:'signup'}, {text:'Sign in', path:'signin'}];
    },

    editPasswordUrl: function() {
      return TwbTools.getFullPath('edit-password');
    },

    submitTapped: function() {
      this.$['forgot-email'].isInvalid = false;
      BnbService.forgotPassword(this.params, this.handleResponse, this.handleError, this);
    },

    handleResponse: function(data) {
      this.fire('message', {message: data.message});
    },

    handleError: function(error) {
      this.fire('message', {message: error.errors[0]});
    }
  });

})();

</script>
