<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">

<dom-module id="bnb-page-card">
  <style>
    :host {
      position: relative;

      display: inline-block;

      box-sizing: border-box;
      width: 320px;
      margin: 5px;

      cursor: pointer;

      border-radius: 2px;
    }

    .header {
      position: relative;
      @apply(--paper-card-header);
    }

    .header iron-image {
      width: 100%;
      padding-bottom: 75%;

      pointer-events: none;

      background-color: lightgray;
    }

    :host ::content h2 {
      margin-top: 0;
      margin-bottom: 2px;
    }

    :host ::content a {
      text-decoration: none;

      color: #9e9e9e;
    }

    .card-content a:hover {
      text-decoration: underline;
    }

    .card-content {
      position:relative;

      overflow: hidden;

      padding: 16px;

      text-overflow: ellipsis;
    }

    .card-content .card-actions {
      position:relative;

      padding: 5px 16px;

      border-top: 1px solid #e8e8e8;
    }

    .header {
      height: 240px;
    }

    .hurt {
      position:absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left:0;

      -webkit-animation: pulse 5s infinite;
      animation: pulse 5s infinite;

      opacity: 1;
      background-color: red;
    }

    @-webkit-keyframes pulse {
      0% {opacity: 0}
      50% {opacity: 0.3}
      100% {opacity: 0}
    }

    @keyframes pulse {
      0% {opacity: 0}
      50% {opacity: 0.3}
      100% {opacity: 0}
    }

    #shadow {
      background-color: var(--paper-card-background-color);
      @apply(--shadow-2dp);
    }

    #shadow:hover {
      @apply(--shadow-elevation-8dp);
    }

  </style>

  <template>
    <paper-material id="shadow" animated$="[[animatedShadow]]" elevation=[[elevation]] on-tap="cardTapped">

      <div class="header">
        <iron-image sizing="cover" preload fade src="[[_computeScreenshotUrl(page)]]"></iron-image>
        <div id="imageCover" class$="[[_computeHurt(page)]]"></div>
      </div>

      <div class="card-content">
        <h2>[[page.name]]</h2>
        <a href="#" on-tap="urlTapped" title="Open url in a new tab">[[page.url]]</a>
      </div>
      <paper-ripple></paper-ripple>

    </paper-material>

  </template>

</dom-module>

<script>

  Polymer({
    is: 'bnb-page-card',

    properties: {
      /**
       * The page of the card.
       */
      page: {
        type: Object,
        value: null
      },

      /**
       * The z-depth of the card, from 0-5.
       */
      elevation: {
        type: Number,
        value: 1
      },

      /**
       * Set this to true to animate the card shadow when setting a new
       * `z` value.
       */
      animatedShadow: {
        type: Boolean,
        value: true
      }
    },

    cardTapped: function(e) {
      this.fire('show-page', {page: this.page});
    },

    urlTapped: function(e) {
      window.open(this.page.url, '_blank');
      e.stopPropagation();
    },

    _computeScreenshotUrl: function(item) {
      return BnbService.BASE_URL + 'pages/' + item.id + '/screenshot?style=thumb';
    },

    _computeHurt: function(item) {
      if (item.uptime_status === 0) {
        return 'hurt';
      }
      return '';
    }

  });
</script>
