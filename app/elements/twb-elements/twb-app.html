

<link rel="import" href="twb-sites.html">
<link rel="import" href="twb-site.html">

<dom-module id="twb-app">
  <style>
    :host {
      @apply(--layout-vertical);
    }
  </style>
  <link rel="stylesheet" href="twb-app.css">

  <template>

    <iron-ajax auto handleAs="json" url="/components/twb-elements/sites.json" response="{{sites}}"></iron-ajax>
    <iron-ajax id="signout-ajax" handleAs="json" url="/users/sign_out.json" method="DELETE" on-core-response="handleSignoutResponse"></iron-ajax>

    <paper-toolbar>
      <paper-icon-button icon="arrow-back" class="{{selected=='sites' ? 'hide' : 'show'}}" on-tap="back"></paper-icon-button>
      <paper-dropdown-menu label="This month">
        <paper-dropdown class="dropdown">
          <paper-menu class="menu">
            <paper-item label="item1">This month</paper-item>
            <paper-item label="item2">This week</paper-item>
            <paper-item label="item3">This day</paper-item>
            <paper-item label="item4">Custom...</paper-item>
          </paper-menu>
        </paper-dropdown>
      </paper-dropdown-menu>
      <div flex></div>
      <paper-icon-button icon="add"></paper-icon-button>
      <paper-icon-button icon="search"></paper-icon-button>
      <paper-menu-button>
        <paper-icon-button icon="more-vert"></paper-icon-button>
        <paper-dropdown class="dropdown" halign="right">
          <paper-menu class="menu">
            <paper-item on-tap="signoutTapped">Logout</paper-item>
          </paper-menu>
        </paper-dropdown>
      </paper-menu-button>
    </paper-toolbar>

    <neon-animated-pages id="pages" flex selected="{{selected}}" transitions="cross-fade-all hero-transition">
      <twb-sites name="sites" sites="{{sites}}" site="{{site}}" on-core-activate="siteSelect">
      </twb-sites>

      <twb-site name="site" site="{{site}}"></twb-site>

    </neon-animated-pages>


  </template>
</dom-module>

<script>
(function() {

  Polymer({

    is: 'twb-app', 

    selected : "sites",

    siteSelect: function() {
      this.selected = "site";
    },

    back: function() {
      //this.site = null;
      this.selected = "sites";
    },

    signoutTapped: function() {
      var ajax = this.$["signout-ajax"];
      ajax.go();
    },

    handleSignoutResponse: function() {
      this.fire('signedout');
    }


  });

})();
</script>
