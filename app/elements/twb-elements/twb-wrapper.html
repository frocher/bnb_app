<link rel="import" href="twb-app.html">
<link rel="import" href="twb-signin.html">
<link rel="import" href="twb-user.html">

<dom-module id="twb-wrapper">
  <style>
    :host {
      @apply(--layout-vertical);
    }

    .pages {
      @apply(--layout-fit);
    }

    .page {
      @apply(--layout-fit);
    }
  </style>
  <template>

    <twb-user id="currentUser"></twb-user>
    <twb-api id="twbApi"></twb-api>

    <more-route-selector>
      <neon-animated-pages id="pages" class="pages" transitions="cross-fade-all">
        <section name="splash" class="page" route="splash">
        </section>
        <twb-app name="app" class="page" route="home"></twb-app>
        <twb-signin name="signin" class="page" route="users"></twb-signin>
      </neon-animated-pages>
    </more-route-selector>

  </template>
</dom-module>

<script>
(function() {

  Polymer({
    is: 'twb-wrapper', 

    ready: function() {
      _this = this;

      if (!MoreRouting.isCurrentUrl("/users")) {
        var user = this.$["currentUser"];
        if (user.token == undefined) {
          MoreRouting.navigateTo('/users/signin');
        }
      }
      
      this.$.pages.querySelector('twb-signin').addEventListener('signedin', function(e) {
        MoreRouting.navigateTo('home');
      });

      this.$.pages.querySelector('twb-signin').addEventListener('signedup', function(e) {
        MoreRouting.navigateTo('home');
      });

      this.$.pages.querySelector('twb-app').addEventListener('signedout', function(e) {
        MoreRouting.navigateTo('home');
      });
    }


  });

})();
</script>

