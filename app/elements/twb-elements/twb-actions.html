<link rel="import" href="twb-service.html">

<script>
/**
 * Encapsulate all global application actions.
 * Local components actions must not exist here.
 */
(function(scope) {
var TwbActions = scope.TwbActions = scope.TwbActions || {};

TwbActions.SIGNED_IN_EVT  = 'signedin';
TwbActions.SIGNED_OUT_EVT = 'signedout';
TwbActions.SHOW_PAGES_EVT = 'show-pages';
TwbActions.SHOW_PAGE_EVT  = 'show-page';
TwbActions.EDIT_PAGE_EVT  = 'edit-page';
TwbActions.MESSAGE_EVT    = 'message';

////////////////////////////////////////////////////////////////////
// Global actions

/**
 * Display a toast message
 */
TwbActions.showMessage = function showMessage(message) {
  this.fire('message', {message: message});
}

////////////////////////////////////////////////////////////////////
// User session management actions

TwbActions.isLogged = function isLogged() {
  return sessionStorage.getItem('accessToken') !== null;
};

TwbActions.signout = function signout() {
  sessionStorage.removeItem('accessToken');
  sessionStorage.removeItem('uid');
};

// TODO...

////////////////////////////////////////////////////////////////////
// Page specific actions

/**
 * Display the pages list
 */
TwbActions.loadPages = function loadPages() {
  TwbService.loadPages({}, this.handleLoadPagesResponse, this.handleLoadPagesError, this);

}

/**
 * Display the pages list
 */
TwbActions.showPageList = function showPageList(message) {
  page('/');
}

/**
 * Display the given page
 */
TwbActions.showPage = function showPage(page) {
  this.fire(TwbActions.SHOW_PAGE_EVT, {page: this.page});
}

/**
 * Edit the given page
 */
TwbActions.editPage = function editPage(page) {
  this.fire(TwbActions.EDIT_PAGE_EVT, {page: this.page});
}

/**
 * Create a new page
 */
TwbActions.createPage = function updatePage(params, response, error, context) {
  TwbService.createPage(params, response, error, context);
}

/**
 * Save the given page
 */
TwbActions.updatePage = function updatePage(page, response, error, context) {
  TwbService.updatePage(page.id, page, response, error, context);
}

/**
 * Delete the given page
 */
TwbActions.deletePage = function deletePage(page, response, error, context) {
  TwbService.deletePage(page.id, response, error, context);
  // TODO : we need to remove the page from the page list in the store
}

})(window);
</script>
