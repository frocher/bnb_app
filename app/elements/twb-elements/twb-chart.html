<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<dom-module id="twb-chart">
  <style>
    :host {
      display: inline-block;
    }
    #canvas {
      width: 100%;
      height: 100%;
      position:relative;
    }
  </style>
  <template>
    <div id="canvas"></div>
  </template>
</dom-module>
<script>

(function() {

  Polymer({
    is: 'twb-chart',

    properties: {
      chart: {
        notify: true
      },
      data: {
        type: Object,
        value: function () {
          return {};
        }
      },
    },

    observers: [
      'updateChart(data.*)'
    ],

    behaviors: [
      Polymer.IronResizableBehavior
    ],

    listeners: {
      'iron-resize': '_onIronResize'
    },

    attached: function() {
      this.async(this.notifyResize, 1);
    },

    _onIronResize: function() {
      this.chart.resizeHandler();
    },

    updateChart: function () {
      console.log('update was called');

      if (this.chart) {
        this.chart.setData(this.data);
      }
      else {
        this.chart = new Morris.Line({
          // ID of the element in which to draw the chart.
          element: this.$.canvas,
          // Chart data records -- each entry in this array corresponds to a point on
          // the chart.
          data: [
            { year: '2008', value: 20 },
            { year: '2009', value: 10 },
            { year: '2010', value: 5 },
            { year: '2011', value: 5 },
            { year: '2012', value: 20 }
          ],
          // The name of the data record attribute that contains x-values.
          xkey: 'year',
          // A list of names of data record attributes that contain y-values.
          ykeys: ['value'],
          // Labels for the ykeys -- will be displayed when you hover over the
          // chart.
          labels: ['Value']
        });
      }
    }

  });

})();
</script>
