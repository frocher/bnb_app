<dom-module id="twb-signin">
  <style>
  </style>

  <template>
    <twb-auth-form id="signin-form" name="signin" title="Sign in" buttons="{{signinButtons}}">

      <paper-input label="E-mail" type="email" value="{{params.email}}">
      </paper-input>

      <paper-input label="Password" autocomplete="off" type="password" value="{{params.password}}">
      </paper-input>

      <paper-checkbox class="colored" checked="{{params.rememberMe}}">remember me</paper-checkbox>

      <div class="actions">
        <paper-button class="colored" on-tap="signinSubmitTapped">Log in</paper-button>
      </div>
    </twb-auth-form>
  </template>
</dom-module>

<script>
(function() {

  Polymer({
    is: 'twb-signin', 

    ready: function() {
      this.params = { name:'', email:'', password:'' };
      this.signinButtons = [{text:'Sign up', path:'signup'}, {text:'Forgot your password', path:'forgot'}];
    },

    signinSubmitTapped: function() {
      TwbService.signin(this.params, this.handleSigninResponse, this.handleSigninError, this);
    },

    handleSigninResponse: function(data) {
      this.initUser(data);
      this.fire('signedin');

      this.params.password = '';
    },

    handleSigninError: function(error) {
      this.showToast(error.errors[0]);
    },

    showToast: function(message) {
      this.fire('message', {message: message});
    },

    initUser: function(data) {
      TwbUserStore.userId   = data.id;
      TwbUserStore.username = data.name;
      TwbUserStore.email    = data.email;
      TwbUserStore.admin    = data.admin;
      TwbUserStore.avatar   = data.avatar_url;

      this.params.password = '';
      this.params.password_confirmation = '';
    }
  });

})();

</script>
