<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-layout.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="bnb-actions.html">
<link rel="import" href="bnb-common-styles.html">
<link rel="import" href="bnb-divider.html">
<link rel="import" href="bnb-period-dropdown.html">
<link rel="import" href="bnb-chart-card.html">

<dom-module id="bnb-page">
  <template>
    <style include="bnb-common-styles">
      :host {
        @apply --layout-vertical;
      }

      #chartsFilter {
        margin:16px;
        padding:16px;
      }

      #charts {
        @apply --layout-vertical;
        @apply --layout-wrap;
        @apply --layout-center-justified;
      }

      paper-item {
        cursor: pointer;
      }
    </style>

    <app-header-layout fullbleed>
      <app-header slot="header" fixed condenses shadow>
        <app-toolbar>
          <paper-icon-button icon="arrow-back" on-tap="backTapped"></paper-icon-button>
          <span>[[page.name]]</span>
          <div class="flex"></div>
          <paper-menu-button horizontal-align="right">
            <paper-icon-button icon="more-vert" slot="dropdown-trigger"></paper-icon-button>
            <paper-listbox slot="dropdown-content">
              <paper-item on-tap="editTapped" hidden$="{{!page.can_edit}}">Settings</paper-item>
              <paper-item on-tap="membersTapped">Members</paper-item>
              <bnb-divider></bnb-divider>
              <paper-item on-tap="deleteTapped" hidden$="{{!page.can_delete}}">Delete</paper-item>
              <paper-item on-tap="leaveTapped" hidden$="{{page.can_delete}}">Leave</paper-item>
            </paper-listbox>
          </paper-menu-button>
        </app-toolbar>
      </app-header>

      <div id="content" class="fit">

        <div id="charts">
          <paper-card id="chartsFilter">
            <span>Stats for&nbsp;</span>
            <bnb-period-dropdown period="{{period}}"></bnb-period-dropdown>
          </paper-card>

          <bnb-chart-card id="lighthouseChart" name="Lighthouse scores" type="bar" data="[[stats.lighthouse]]" model="[[lighthouseModel]]" has-details="true"></bnb-chart-card>
          <bnb-chart-card id="performanceChart" name="Performance" type="line" data="[[stats.performance]]" model="[[performanceModel]]" has-details="true"></bnb-chart-card>
          <bnb-chart-card id="uptimeChart" name="Uptime" type="line" data="[[stats.uptime]]" model="[[uptimeModel]]" has-details="true"></bnb-chart-card>
          <bnb-chart-card id="requestsChart" name="Assets count" type="area" data="[[stats.requests]]" model="[[requestsModel]]" has-details="true"></bnb-chart-card>
          <bnb-chart-card id="bytesChart" name="Assets size" type="area" data="[[stats.bytes]]" model="[[bytesModel]]" has-details="true"></bnb-chart-card>
        </div>

      </div>
    </app-header-layout>

    <paper-dialog id="deleteDlg" modal>
      <p>Are you really sure you want to delete page ? All data will be lost</p>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus on-tap="deletePageTapped">Delete</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="leaveDlg" modal>
      <p>Leave this page, sure ?</p>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus on-tap="leavePageTapped">Leave</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>
    class BnbPage extends BnbActions(Polymer.Element) {
      static get is() { return 'bnb-page'; }

      static get properties() {
        return {
          page: {
            type: Object,
            statePath: 'page'
          },
          stats: {
            type: Object,
            statePath: 'page_stats'
          },
          period: Object,
          lighthouseModel: Object,
          performanceModel: Object,
          uptimeModel: Object,
          requestsModel: Object,
          bytesModel: Object
        }
      }

      ready() {
        super.ready();

        this.lighthouseModel = [
          {name: 'pwa', color: '#4A148C', label: 'pwa'},
          {name: 'performance', color: '#7B1FA2', label: 'performance'},
          {name: 'accessibility', color: '#9C27B0', label: 'accessibility'},
          {name: 'best_practices', color: '#BA68C8', label: 'best practices'},
          {name: 'seo', color: '#E1BEE7', label: 'seo'}
        ];

        this.performanceModel = [
          {name: 'first_byte', color: '#E65100', label: 'first byte', suffix: 'ms'},
          {name: 'first_paint', color: '#F57C00', label: 'first paint', suffix: 'ms'},
          {name: 'speed_index', color: '#FF9800', label: 'speed index'},
          {name: 'interactive', color: '#FFB74D', label: 'interactive', suffix: 'ms'}
        ];

        this.uptimeModel = [
          {name: 'uptime', color: '#00C853', label: 'uptime', suffix: '%'}
        ];

        this.requestsModel = [
          {name: 'html', color: '#01579B', label: 'html'},
          {name: 'css', color: '#0288D1', label: 'css'},
          {name: 'js', color: '#03A9F4', label: 'javascript'},
          {name: 'image', color: '#4FC3F7', label: 'image'},
          {name: 'font', color: '#81D4FA', label: 'font'},
          {name: 'other', color: '#B3E5FC', label: 'other'}
        ];

        this.bytesModel = [
          {name: 'html', color: '#880E4F', label: 'html', suffix: 'kb'},
          {name: 'css', color: '#C2185B', label: 'css', suffix: 'kb'},
          {name: 'js', color: '#D81B60', label: 'javascript', suffix: 'kb'},
          {name: 'image', color: '#EC407A', label: 'image', suffix: 'kb'},
          {name: 'font', color: '#F48FB1', label: 'font', suffix: 'kb'},
          {name: 'other', color: '#F8BBD0', label: 'other', suffix: 'kb'}
        ];

        this.$.lighthouseChart.addEventListener('details', this.lightHouseChartDetailsTapped.bind(this));
        this.$.performanceChart.addEventListener('details', this.performanceChartDetailsTapped.bind(this));
        this.$.uptimeChart.addEventListener('details', this.uptimeChartDetailsTapped.bind(this));
        this.$.requestsChart.addEventListener('details', this.requestsChartDetailsTapped.bind(this));
        this.$.bytesChart.addEventListener('details', this.bytesChartDetailsTapped.bind(this));
      }

      backTapped() {
        this.dispatch('updateRoute', 'home');
      }

      editTapped() {
        this.dispatch('updateRoute', 'edit-page/' + this.page.id);
      }

      membersTapped() {
        this.dispatch('updateRoute', 'members/' + this.page.id);
      }

      deleteTapped() {
        this.$.deleteDlg.open();
      }

      deletePageTapped() {
        this.deletePage(this.page.id);
      }

      leaveTapped(e) {
        this.$.leaveDlg.open();
      }

      leavePageTapped(e) {
        this.deletePageMember(this.page.id, -1);
      }

      lightHouseChartDetailsTapped(e) {
        this.dispatch('updateRoute', 'lighthouse-details/' + this.page.id);
      }

      performanceChartDetailsTapped(e) {
        this.dispatch('updateRoute', 'performance-details/' + this.page.id);
      }

      uptimeChartDetailsTapped(e) {
        this.dispatch('updateRoute', 'uptime-details/' + this.page.id);
      }

      requestsChartDetailsTapped(e) {
        this.dispatch('updateRoute', 'requests-details/' + this.page.id);
      }

      bytesChartDetailsTapped(e) {
        this.dispatch('updateRoute', 'bytes-details/' + this.page.id);
      }
    }
    window.customElements.define(BnbPage.is, BnbPage);
  </script>
</dom-module>
