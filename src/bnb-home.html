<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/app-layout/app-layout.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="bnb-actions.html">
<link rel="import" href="bnb-common-styles.html">
<link rel="import" href="bnb-divider.html">
<link rel="import" href="bnb-page-card.html">

<dom-module id="bnb-home">
  <template>
    <style include="bnb-common-styles">

      bnb-divider {
        width: 100%;
      }

      paper-item {
        cursor: pointer;
      }

      #noData, #loading {
        display: flex;
        width: 100%;
        height: calc(100vh - 65px);
        color: #999;
        font-size: 24px;
        align-items: center;
        justify-content: center;
      }

      #withData {
        display: block;
        position: relative;
        @apply --layout-horizontal;
        @apply --layout-center-center;
        @apply --layout-wrap;
        margin-top: 10px;
      }

      #withData > .item {
        -webkit-flex: 1 calc(25% - 30px);
        flex: 1 calc(25% - 30px);
        max-width: calc(25% - 30px);
        margin: 10px;
        text-decoration: none;
      }

      @media (max-width: 1200px) {
        #withData {
          padding-left: 10px;
          padding-right: 10px;
        }
        #withData > .item {
          -webkit-flex: 1 calc(33% - 20px);
          flex: 1 calc(33% - 20px);
          max-width: calc(33% - 20px);
          margin: 10px;
          text-decoration: none;
        }
      }

      @media (max-width: 700px) {
        #withData {
          padding-left: 10px;
          padding-right: 10px;
        }
        #withData > .item {
          -webkit-flex: 1 calc(50% - 20px);
          flex: 1 calc(50% - 20px);
          max-width: calc(50% - 20px);
          margin: 10px;
          text-decoration: none;
        }
      }

      @media (max-width: 400px) {
        #withData{
          padding-left: 10px;
          padding-right: 10px;
        }
        #withData> .item {
          -webkit-flex: 1 calc(100% - 10px);
          flex: 1 calc(100% - 10px);
          max-width: calc(100% - 10px);
          margin: 5px;
          text-decoration: none;
        }
      }
    </style>

    <app-header-layout fullbleed>
      <app-header slot="header" fixed condenses shadow>
        <app-toolbar>
          <span>All pages</span>
          <div class="flex"></div>
          <paper-icon-button icon="add" on-tap="addTapped"></paper-icon-button>
          <paper-menu-button horizontal-align="right">
            <paper-icon-button icon="more-vert" slot="dropdown-trigger"></paper-icon-button>
            <paper-listbox slot="dropdown-content">
              <paper-item on-tap="preferencesTapped">User preferences</paper-item>
              <bnb-divider></bnb-divider>
              <paper-item on-tap="signoutTapped">Log out</paper-item>
            </paper-listbox>
          </paper-menu-button>
        </app-toolbar>
      </app-header>
      <iron-pages selected="[[computeSelected(pages)]]">
        <section id="loading">
          <span>Loading&nbsp;</span>
          <paper-spinner active></paper-spinner>
        </section>
        <section id="noData">Don't you dare try the + button in the toolbar !</section>
        <section id="withData">
          <template is="dom-repeat" items="[[pages]]" sort="sortPages">
            <bnb-page-card page="[[item]]" class="item"></bnb-page-card>
          </template>
        </section>
      </iron-pages>
    </app-header-layout>

  </template>
  <script>

    class BnbHome extends BnbActions(Polymer.Element) {
      static get is() { return 'bnb-home'; }

      static get properties() {
        return {
          pages: {
            type: Array,
            statePath: 'pages'
          }
        }
      }

      computeSelected(pages) {
        if (pages === null || pages === undefined) {
          return 0;
        }
        if (pages.length === 0) {
          return 1;
        }
        return 2;
      }

      sortPages(first, second) {
        let a = first.name.toUpperCase();
        let b = second.name.toUpperCase();
        return a.localeCompare(b);
      }

      selectedChanged() {
        this.page = this.pages[this.selected];
      }

      addTapped() {
        this.dispatch('updateRoute', 'add-page');
      }

      preferencesTapped() {
        this.dispatch('updateRoute', 'user-preferences');
      }

      signoutTapped() {
        this.signout();
      }
    }

    customElements.define(BnbHome.is, BnbHome);
  </script>
</dom-module>
