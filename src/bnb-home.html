<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/app-layout/app-layout.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-list-box/paper-listbox.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="bnb-common-styles.html">
<link rel="import" href="bnb-data.html">
<link rel="import" href="bnb-divider.html">
<link rel="import" href="bnb-page-card.html">

<dom-module id="bnb-home">
  <template>
    <style include="bnb-common-styles">

      #noData, #loading {
        display: flex;
        width: 100%;
        height: calc(100vh - 65px);
        color: #999;
        font-size: 24px;
        align-items: center;
        justify-content: center;
      }

      #withData {
        padding:24px;
        @apply --layout-fit;
        @apply --layout-wrap;
        @apply --layout-horizontal;
        @apply --layout-center-justified;
      }

      bnb-divider {
        width: 100%;
      }

      paper-item {
        cursor: pointer;
      }
    </style>

    <bnb-data id="data"></bnb-data>

    <app-header-layout fullbleed>
      <app-header slot="header" fixed condenses shadow>
        <app-toolbar>
          <span>All pages</span>
          <div class="flex"></div>
          <paper-icon-button icon="add" on-tap="addTapped"></paper-icon-button>
          <paper-menu-button horizontal-align="right">
            <paper-icon-button icon="more-vert" slot="dropdown-trigger"></paper-icon-button>
            <paper-listbox slot="dropdown-content">
              <paper-item on-tap="preferencesTapped">User preferences</paper-item>
              <bnb-divider></bnb-divider>
              <paper-item on-tap="signoutTapped">Log out</paper-item>
            </paper-listbox>
          </paper-menu-button>
        </app-toolbar>
      </app-header>
      <iron-pages selected="[[computeSelected(pages)]]">
        <section id="loading">
          <span>Loading&nbsp;</span>
          <paper-spinner active></paper-spinner>
        </section>
        <section id="noData">Don't you dare try the + button in the toolbar !</section>
        <section id="withData">
          <template is="dom-repeat" items="[[pages]]" sort="sortPages">
            <bnb-page-card page="[[item]]"></bnb-page-card>
          </template>
        </section>
      </iron-pages>
    </app-header-layout>

  </template>
  <script>

    class BnbHome extends Polymer.mixinBehaviors([Polymer.NeonAnimatableBehavior, Polymer.IronResizableBehavior], Polymer.Element) {
      static get is() { return 'bnb-home'; }

      static get properties() {
        return {
          pages: Array,
          period: Object
        }
      }

      computeSelected(pages) {
        if (pages === null || pages === undefined) {
          return 0;
        }
        if (pages.length === 0) {
          return 1;
        }
        return 2;
      }

      sortPages(first, second) {
        let a = first.name.toUpperCase();
        let b = second.name.toUpperCase();
        return a.localeCompare(b);
      }

      selectedChanged() {
        this.page = this.pages[this.selected];
      }

      addTapped() {
        window.history.pushState({}, null, '/add-page');
        window.dispatchEvent(new CustomEvent('location-changed'));
      }

      preferencesTapped() {
        this.dispatchEvent(new CustomEvent('edit-preferences', {bubbles: true, composed: true}));
      }

      signoutTapped() {
        this.$.data.signout();
      }
    }

    customElements.define(BnbHome.is, BnbHome);
  </script>
</dom-module>
